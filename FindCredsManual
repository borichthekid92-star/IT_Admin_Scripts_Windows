# Find-CredentialFiles.ps1 Manual

## Overview

Find-CredentialFiles.ps1 is a Windows PowerShell-based security auditing tool designed to identify files that may contain sensitive credentials, API keys, passwords, and other authentication materials across a Windows system. The tool searches by both file naming patterns and file content analysis.

**IMPORTANT**: This tool should only be used on systems you own or have explicit authorization to audit. Unauthorized access to systems is illegal.

---

## Prerequisites

- **PowerShell 5.0 or higher** (included with Windows 10/Server 2016+)
- **Administrator privileges** (required to access certain directories)
- **Authorization** to audit the target system
- Script execution policy must allow script execution (see Setup section)

---

## Setup & Execution

### Enable Script Execution

By default, Windows blocks PowerShell script execution. To enable it:

```powershell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

This allows locally created scripts to run while maintaining security for downloaded scripts.

### Running the Script

Navigate to the script directory and execute:

```powershell
.\Find-CredentialFiles.ps1
```

Or run with administrator privileges:

```powershell
powershell -NoProfile -ExecutionPolicy Bypass -File "C:\path\to\Find-CredentialFiles.ps1"
```

---

## Parameters

### SearchPath
- **Type**: String
- **Default**: `C:\`
- **Description**: The root directory to begin searching. Use this to limit scope.
- **Examples**:
  - `C:\Users` - Search only user profiles
  - `D:\` - Search alternate drives
  - `C:\Program Files` - Search application directories

### OutputFile
- **Type**: String
- **Default**: (empty - no file output)
- **Description**: Optional CSV file path to export results. Results are displayed in console regardless.
- **Examples**:
  - `.\results.csv`
  - `C:\audits\cred_findings_2025.csv`

### MaxDepth
- **Type**: Integer
- **Default**: `-1` (unlimited depth)
- **Description**: Limits directory traversal depth. Useful for quick searches.
- **Examples**:
  - `3` - Search up to 3 levels deep
  - `1` - Search immediate directory only
  - `-1` - Search all subdirectories

---

## Usage Examples

### Basic Search (Full System)
```powershell
.\Find-CredentialFiles.ps1
```
Searches entire C:\ drive, results displayed on console.

### Search User Profiles Only
```powershell
.\Find-CredentialFiles.ps1 -SearchPath "C:\Users"
```
Focuses on user directories where credentials are commonly found.

### Search with CSV Export
```powershell
.\Find-CredentialFiles.ps1 -SearchPath "C:\Users" -OutputFile "findings.csv"
```
Searches users directory and exports results to CSV file.

### Quick Shallow Search
```powershell
.\Find-CredentialFiles.ps1 -SearchPath "C:\Users" -MaxDepth 2
```
Limits search to top 2 levels of user directory for faster execution.

### Search Specific Application Directory
```powershell
.\Find-CredentialFiles.ps1 -SearchPath "C:\Program Files\ApplicationName"
```
Targets specific application folder.

---

## Search Patterns

### File Name Patterns
The script searches for files with names containing:
- Credential keywords: `password`, `credential`, `secret`, `auth`, `token`
- Key files: `*.pem`, `*.key`, `*.ppk`, `id_rsa`, `id_dsa`
- Certificate files: `*.pfx`, `*.p12`
- Config/Database: `*.env`, `.git-credentials`, `config.txt`, `database.txt`, `backup.txt`
- Other: `vault`, `htpasswd`, `shadow`

### File Extensions Analyzed
The script scans content of files with these extensions:
- Configuration: `*.xml`, `*.config`, `*.cfg`, `*.ini`, `*.yml`, `*.yaml`, `*.conf`, `*.properties`
- Logs: `*.log`
- Keys: `*.key`

### Excluded Extensions
Files with these extensions are automatically skipped:
- `*.exe`, `*.dll`, `*.manifest`

### Excluded Paths
- `C:\Windows\WinSxS\` (Windows component store)

---

## Output

### Console Output
The script provides real-time feedback:
- Files found are listed with yellow highlighting
- Patterns being searched are displayed in gray
- Total count of findings shown at completion

### CSV Export Format
If `-OutputFile` is specified, the CSV contains:
| Field | Description |
|-------|-------------|
| FileName | Name of the file |
| FullPath | Complete file path |
| Directory | Parent directory |
| Size | File size in bytes |
| Extension | File extension |
| Created | File creation timestamp |
| Modified | Last modification timestamp |
| Accessed | Last access timestamp |

---

## Interpreting Results

### High Priority Findings
- SSH private keys (`id_rsa`, `id_dsa`, `*.pem`)
- Certificate files (`*.pfx`, `*.p12`)
- Password manager databases (`*.kdbx`)
- Configuration files containing credentials
- `.env` files with API keys or passwords

### Medium Priority Findings
- Log files containing authentication attempts
- Backup files with potentially sensitive data
- Configuration files in user directories
- Text files named with credential references

### Investigation Steps
1. **Review the file** - Check if it actually contains credentials
2. **Identify owner** - Determine which user/application created it
3. **Assess exposure** - Check file permissions and access logs
4. **Remediate** - Move, delete, or secure the file appropriately
5. **Document** - Record findings for compliance/audit purposes

---

## Performance Considerations

### Optimize Search Speed
- Use `-SearchPath` to limit scope (e.g., `C:\Users` instead of `C:\`)
- Use `-MaxDepth` to limit directory traversal depth
- Exclude network drives and slow storage
- Run during off-hours on production systems

### Example Quick Search
```powershell
.\Find-CredentialFiles.ps1 -SearchPath "C:\Users\$env:USERNAME" -MaxDepth 2 -OutputFile "user_creds.csv"
```

### Scan Large Systems
For enterprise systems, consider breaking searches by user:
```powershell
$Users = Get-ChildItem -Path "C:\Users" -Directory | Select-Object -ExpandProperty Name
foreach ($User in $Users) {
    .\Find-CredentialFiles.ps1 -SearchPath "C:\Users\$User" -OutputFile "results_$User.csv"
}
```

---

## Troubleshooting

### "Access Denied" Errors
**Problem**: Script cannot access certain directories.
**Solution**: 
- Run PowerShell as Administrator
- The script includes error handling; these files will be skipped

### No Results Found
**Problem**: Script completes but finds no files.
**Possible Causes**:
- No credential files on the system (good security posture)
- Files are in excluded paths
- Incorrect SearchPath parameter
**Verification**: 
```powershell
Get-ChildItem -Path "C:\Users" -Filter "*password*" -Recurse -ErrorAction SilentlyContinue
```

### Script Execution Policy Error
**Problem**: "cannot be loaded because running scripts is disabled"
**Solution**:
```powershell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

### Slow Performance
**Problem**: Script takes too long to complete.
**Solutions**:
- Use `-MaxDepth` parameter to limit depth
- Use `-SearchPath` to search specific directories only
- Run during off-peak hours
- Exclude slow network shares

### CSV Export Issues
**Problem**: OutputFile cannot be written.
**Causes**:
- Path doesn't exist
- No write permissions
- File is locked by another process
**Solution**: Verify path and permissions before running script

---

## Security Best Practices

### When Running This Tool
1. **Authorization First** - Ensure you have written authorization to audit the system
2. **Documentation** - Log when and where the audit was run
3. **Secure Results** - Treat findings as sensitive data
4. **Clean Up** - Remove output files containing credential references after remediation
5. **Log Access** - Monitor and log access to the script itself

### After Finding Credentials
1. **Do Not Expose** - Don't share findings in plain text emails
2. **Rotate Credentials** - Any exposed credentials should be rotated immediately
3. **Investigate Root Cause** - Why were credentials stored unsecurely?
4. **Implement Controls** - Use secret management solutions (e.g., password managers, AWS Secrets Manager)
5. **Educate Users** - Train users on proper credential handling

### Recommended Secret Management Solutions
- **Azure Key Vault** - Cloud-based secret storage
- **AWS Secrets Manager** - AWS native solution
- **HashiCorp Vault** - Enterprise secret management
- **CyberArk** - Enterprise privilege access management
- **1Password/Bitwarden** - Team password managers

---

## Educational Use Cases

### Incident Response Training
Use this tool to create scenarios where students must identify compromised systems:
```powershell
# Stage credentials in test environment
"password: admin123" | Out-File "C:\test_files\config.txt"
# Have students run the script to find it
```

### Forensic Analysis
Integrate with forensic workflows to identify suspicious credential storage:
- Run on compromised systems during investigation
- Export results for evidence documentation
- Correlate with access logs and timeline analysis

### Security Awareness
Demonstrate to users where credentials are often stored:
- Run in audit mode with management approval
- Show employees improper storage locations
- Educate on better practices

---

## Legal Considerations

**Authorization Required**: Only use this tool on systems you own or have explicit written authorization to audit.

**Compliance**: Document your audit runs for:
- SOC 2
- PCI-DSS
- HIPAA
- ISO 27001
- NIST frameworks

**Data Handling**: Treat results as sensitive information containing potential credential references.

---

## Version History

| Version | Date | Changes |
|---------|------|---------|
| 1.0 | 2025 | Initial release |

---

## Support & Feedback

For issues, improvements, or security concerns, document:
- PowerShell version (`$PSVersionTable`)
- Windows OS version
- SearchPath used
- Error messages (if any)
- Results found count

---

## Appendix: Common Credential File Locations

### Windows User Profiles
- `C:\Users\[Username]\AppData\Local\` - Application data
- `C:\Users\[Username]\.ssh\` - SSH keys
- `C:\Users\[Username]\.git\` - Git credentials

### Application Directories
- `C:\Program Files\[AppName]\config\` - Configuration files
- `C:\ProgramData\[AppName]\` - Shared application data
- Application temp directories

### Development Environments
- `.env` files in project roots
- `.git-credentials` in user home
- `package.json` and dependency files
- Python virtual environments with configs

### Web Applications (IIS)
- `C:\inetpub\wwwroot\web.config` - IIS configuration
- `C:\inetpub\logs\` - IIS logs
- Database connection strings in config files

---

**Last Updated**: 2025
**Manual Version**: 1.0
